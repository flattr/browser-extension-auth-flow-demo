# Client demo

> Note that the certificates used for signing will likely change before this goes live.

## Checking if the visitor is a paying Flattr user

The visiting extension will attach an event listener (`flattr-request-payload`) on the document. Trigger this event to request the payload. If there is an active user the extension will respond with `flattr-payload` with an attached payload.

<!-- TODO: Example code -->

### Payload structure<a name="payload"></a>

In its compact form the payload will consist of two base64 encoded parts separated by a dot ( . ), which are:

* data
* signature

Therefore, a payload will look like the following.

`xxxx.yyyyyyyyyyyyyyyy`

Let's break down the different parts.

**Data**

The first part is the actual data about the user, in the form of a json object. There are currently
two properties: paying and iat.

Example JSON data could be:

	{
	  "paying": true,
	  "iat": 1603885771
	}

The JSON object is then base64 encoded to form the first part of the payload.

**Signature**

The second and last part of the payload is the data signature. The signature is used to verify that the message wasn't changed along the way and to verify that the payload is from Flattr.

The signature is generated by cryptographically signing the (unencoded) data part of the payload and then base64 encoding the result. The algorithm used is currently RSA with SHA-256.


**Verifying the payload signature**

[Example webpage](demo/index.html)
[Example JS](demo/main.js)
